<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title><%= title%> </title>

    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>
 
    <script type="text/javascript">

   var map, selectControl, selectedFeature;



        function onPopupClose(evt) {
            selectControl.unselect(selectedFeature);
        }
        function onFeatureSelect(feature) {
            selectedFeature = feature;
            var str = "<table style=\'font-size: 1.5em\'><tr><th colspan=2>"+feature.layer.name+"</th></tr>";
            for(attr in feature.attributes){
             str = str + "<tr><td>"+attr+"</td><td>"+feature.attributes[attr]+"</td></tr>";
            };
            str = str + "</table>"
            popup = new OpenLayers.Popup.FramedCloud("chicken", 
                                     feature.geometry.getBounds().getCenterLonLat(),
                                     null,
                                     "<div style=\'font-size:.5em\'>"+str+"</div>",
                                     null, true, onPopupClose);
            feature.popup = popup;
            map.addPopup(popup);
        }
        function onFeatureUnselect(feature) {
            map.removePopup(feature.popup);
            feature.popup.destroy();
            feature.popup = null;
        }    

   function init(){
      var options = {
       projection: new OpenLayers.Projection("EPSG:900913"),
       displayProjection: new OpenLayers.Projection("EPSG:4326"),
       units: "m",
       maxResolution: 156543.0339,
       maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
       20037508.34, 20037508.34),
       controls: [new OpenLayers.Control.Navigation(),
                  new OpenLayers.Control.PanZoomBar(),
                  new OpenLayers.Control.LayerSwitcher(),
                  new OpenLayers.Control.Permalink(),
                  new OpenLayers.Control.ScaleLine(),
                  new OpenLayers.Control.MousePosition() ]
      };

      map = new OpenLayers.Map("map", options);
      var mapnik = new OpenLayers.Layer.OSM.Mapnik("OpenStreetMap"); 
      map.addLayer(mapnik);
 <% for(i in 1:length(nmk)){ %>
      var <%= nmk[i]%> = new OpenLayers.Layer.GML("<%= nmk[i]%>","<%= paste(nmk[i],".gml",sep="")%>",{
        projection: new OpenLayers.Projection("EPSG:4326"),
        style: {
  "strokeWidth": 1,
  "strokeColor": "#000000",
  "fillColor": "<%= colours[i]%>",
  "pointRadius": 6
           }

       });

      map.addLayer(<%= nmk[i]%>);
 <% } %>


     selectControl = new OpenLayers.Control.SelectFeature(
                [<%= paste(nmk,collapse=",")%>],
                {onSelect: onFeatureSelect, onUnselect: onFeatureUnselect}
            );
            
            map.addControl(selectControl);
            selectControl.activate();


map.zoomToExtent(
      new OpenLayers.Bounds(
      <%= bounds%>
      ).transform(map.displayProjection, map.projection)
      );

};

        function showStatus(text) {
            document.getElementById("status").innerHTML = text;            
        }

        </script>
    </head>
    <body onload="init()">
        <h1 id="title"><%= title%></h1>
        <div id="map" style="height:600px;width:600px" ></div>
        <div id="status"></div>
    </body>
</html>

